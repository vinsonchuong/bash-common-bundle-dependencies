#!/usr/bin/env bash
set -o errexit
set -o nounset
# set -o xtrace
set -o pipefail

eval "$(environment)"
eval "$(parse-options help:h -- "$@")"

if [[ $help ]]
then
	cat "$HELP"
	exit
fi

declare -A dependencies

parse() {
	depends=()
	optdepends=()
	makedepends=()
	checkdepends=()
	eval "$(cat)"
	for dependency in "${depends[@]+"${depends[@]}"}" "${optdepends[@]+"${optdepends[@]}"}" "${makedepends[@]+"${makedepends[@]}"}" "${checkdepends[@]+"${checkdepends[@]}"}"
	do
		echo "Bundling: ${dependency}"
		curl "https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=${dependency}" | parse
	done
}

cat - 'PKGBUILD' <<EOF | parse
makedepends=('clidoc')
checkdepends=('bats-git')
EOF
